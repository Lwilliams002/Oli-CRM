
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="Beauty Recovery Home">
    <title>Beauty Recovery Home</title>
    <meta property="og:title" content="Dashboard – Beauty Recovery Home" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://lwilliams002.github.io/Oli-CRM" />
    <meta property="og:image" content="https://lwilliams002.github.io/Oli-CRM/assets/images/download.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Dashboard – Beauty Recovery Home" />
    <meta name="twitter:description" content="Beauty Recovery Home" />
    <meta name="twitter:image" content="https://lwilliams002.github.io/Oli-CRM" />

    <!-- Favicon icon -->
    <link rel="icon" type="image/png" href="assets/images/favicon-32x32.png">
    <!-- Base Styling  -->
    <link rel="stylesheet" href="assets/main/css/fonts.css">
    <link rel="stylesheet" href="assets/main/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
    <script>
      // Initialize Supabase client
      const SUPABASE_URL = 'https://aqkkmgjlcxdbuhwzjeou.supabase.co';
      const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFxa2ttZ2psY3hkYnVod3pqZW91Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU3MjYxNjAsImV4cCI6MjA2MTMwMjE2MH0.kVMtxC6XgrGA8BFwbruCOY5KYv84Phb1M6gi2brojtY';
      const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    </script>

</head>

<body>
    <div id="main-wrapper" class="show">

        <!-- start section sidebar -->
        <aside class="left-panel nicescroll-box">
            <nav class="navigation">
                <ul class="list-unstyled main-menu">
                    <li class="has-submenu active">
                        <a href="index.html">
                            <i class="fas fa-th-large"></i>
                            <span class="nav-label">Dashboard</span>
                        </a>
                    </li>

                    <li class="has-submenu">
                        <a href="javascript:void()" class="has-arrow mm-collapsed">
                            <i class="fas fa-users"></i>
                            <span class="nav-label">Patients</span>
                        </a>
                        <ul class="list-unstyled mm-collapse">
                            <li><a href="new-patient.html">New Patient</a></li>
                            <li><a href="all-patients.html">All Patients</a></li>
                        </ul>
                    </li>
                    <li class="has-submenu">
                        <a href="new-appointment.html">
                            <i class="fas fa-calendar-plus"></i>
                            <span class="nav-label">Appointment</span>
                        </a>
                    </li>


                </ul>
            </nav>

        </aside>
        <!-- End section sidebar -->


        <!-- start logo components -->
        <div class="nav-header">
            <div class="brand-logo">
                <a href="index.html"> <img class="logo-tabib" src="assets/images/download.png" alt=""></a>
                <a href="index.html"><img class="brand-title" src="assets/images/logo.png" alt=""></a>
            </div>
        </div>
        <!-- End logo components -->


        <!-- start section header -->
        <div class="header">
            <header class="top-head container-fluid">
                <div class="nav-control">
                    <div class="hamburger">
                        <span class="line"></span><span class="line"></span><span class="line"></span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="fullscreen notification_dropdown widget-5">
                        <div class="full">
                            <a class="text-dark" href="#!" onclick="javascript:toggleFullScreen()">
                                <i class="fas fa-expand"></i>
                            </a>
                        </div>
                    </div>

                    <div class="my-account-wrapper widget-7">
                        <div class="account-wrapper">
                            <div class="account-control">
                                <a class="login header-profile" href="#" title="Sign in">
                                    <div class="header-info">
                                        <span id="user-email">Dr Roberts</span>
                                        <small>Admin</small>
                                    </div>

                                </a>
                                <div class="account-dropdown-form dropdown-container">
                                    <div class="form-content">
                                        <a href="page-login.html">
                                            <i class="fas fa-sign-in-alt"></i>
                                            <span class="ml-2">Logout </span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
        </div>
        <!-- End section header -->

        <!-- start section content -->
        <div class="content-body">
            <div class="warper container-fluid">
                <div class="all-patients main_container">
                    <div class="row page-titles mx-0">
                        <div class="col-sm-6 p-md-0">
                            <div class="welcome-text">
                                <h4 class="text-primary">New Patient</h4>
                            </div>
                        </div>
                        <div class="col-sm-6 p-md-0 justify-content-sm-end mt-2 mt-sm-0 d-flex">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                            </ol>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card">
                                <div class="card-header fix-card">
                                    <div class="row">
                                        <div class="col-8">
                                            <h4 class="card-title"> All Patients </h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table id="example2" class="display nowrap">
                                            <thead>
                                                <tr>
                                                    <th></th>
                                                    <th>First Name</th>
                                                    <th>Last Name</th>
                                                    <th>Email</th>
                                                    <th>Mobile No.</th>
                                                    <th>Birthday</th>
                                                    <th>Marital Status</th>
                                                    <th>Sex</th>
                                                    <th>Blood Group</th>
                                                    <th>Weight</th>
                                                    <th>Height</th>
                                                    <th>Address</th>
                                                    <th>Patient History</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody id="patients-body">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <!-- Modal -->
                        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                            aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        ...
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-primary">Save changes</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End section content -->


        <!-- start section footer -->
        <div class="footer ">
            <div class="copyright ">
                <p class="mb-0">Copyright © Designed &amp; Developed by <a href="uxign.com" target="_blank">Uxign</a>
                    2022
                </p>
            </div>
        </div>
        <!-- End section footer -->


    </div>


    <!-- Show data patient -->
    <div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
        <!-- <div > -->
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="myModalLabel"><img class="rounded-circle" width="35"
                            src="https://via.placeholder.com/150/f8f8f8/2b2b2b" alt=""> Tiger Nixon </h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <div class="insertHere"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>
    <!-- End Show data patient -->


    <!-- Modal -->
    <div class="modal fade" id="modal-edit" tabindex="-1" aria-labelledby="modal-title-edit-row" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modal-title-edit-row">Angelica Ramos</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="basic-form">
                                <form id="edit-patient-form">
                                    <div class="row">
                                        <div class="col-xl-6">
                                            <div class="form-group row">
                                                <div class="col-lg-12">
                                                    <input id="edit-firstName" name="firstName" type="text" class="form-control" placeholder="First Name">
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <div class="col-lg-12">
                                                    <input id="edit-lastName" name="lastName" type="text" class="form-control" placeholder="Last Name">
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <div class="col-lg-12">
                                                    <input id="edit-email" name="email" type="email" class="form-control" placeholder="Email">
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <div class="col-lg-12">
                                                    <input id="edit-mobile" name="mobile" type="text" class="form-control" placeholder="Mobile No.">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xl-6">
                                            <div class="form-group row">
                                                <div class="col-lg-12">
                                                    <div class="input-group">
                                                        <input id="edit-birthday" name="birthday" type="text" class="form-control" placeholder="Birthday">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <div class="col-lg-12">
                                                    <select id="edit-maritalStatus" name="maritalStatus" class="form-control form-select">
                                                        <option value="">Marital status</option>
                                                        <option>Married</option>
                                                        <option>Unmarried</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <div class="col-lg-12">
                                                    <select id="edit-sex" name="sex" class="form-control form-select">
                                                        <option value="">Sex</option>
                                                        <option>Male</option>
                                                        <option>Female</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <div class="col-lg-12">
                                                    <select id="edit-bloodGroup" name="bloodGroup" class="form-control form-select">
                                                        <option value="">Blood Group</option>
                                                        <option>A+</option>
                                                        <option>A-</option>
                                                        <option>B+</option>
                                                        <option>B-</option>
                                                        <option>O+</option>
                                                        <option>O-</option>
                                                        <option>AB+</option>
                                                        <option>AB-</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xl-4"></div>
                                        <div class="col-xl-4">
                                            <div class="form-group row">
                                                <div class="col-lg-12">
                                                    <input id="edit-weight" name="weight" type="text" class="form-control" placeholder="Patient Weight">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xl-4">
                                            <div class="form-group row">
                                                <div class="col-lg-12">
                                                    <input id="edit-height" name="height" type="text" class="form-control" placeholder="Patient Height">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xl-4">
                                            <div class="form-group">
                                                <div class="col-lg-12">
                                                </div>
                                                <textarea id="edit-address" name="address" class="form-control" placeholder="Address" rows="4"></textarea>
                                            </div>
                                        </div>
                                        <div class="col-xl-8">
                                            <div class="form-group">
                                                <textarea id="edit-history" name="history" class="form-control" placeholder="Patient History" rows="4"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                    <button type="submit" form="edit-patient-form" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>
    <!--End Modal -->


    <!-- JQuery v3.5.1 -->
    <script src="assets/plugins/jquery/jquery.min.js"></script>

    <!-- popper js -->
    <script src="assets/plugins/popper/popper.min.js"></script>

    <!-- Bootstrap -->
    <script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>

    <!-- Moment -->
    <script src="assets/plugins/moment/moment.min.js"></script>

    <!-- Date Range Picker -->
    <script src="assets/plugins/daterangepicker/daterangepicker.min.js"></script>

    <!-- Datatable -->
    <script src="assets/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="assets/js/init-tdatatable.js"></script>

    <!-- Main Custom JQuery -->
    <script src="assets/js/toggleFullScreen.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/option-themes.js"></script>



    <script>
      $(document).ready(async function() {
        const table = $('#example2').DataTable();
        const { data: patients, error } = await supabaseClient
          .from('patients')
          .select('*');
        if (error) {
          console.error('Error loading patients:', error);
          return;
        }
        table.clear();
        patients.forEach(p => {
          table.row.add([
            `<img class="rounded-circle" width="35" src="https://via.placeholder.com/35/f8f8f8/2b2b2b" alt="">`,
            p.first_name,
            p.last_name,
            p.email,
            p.phone || '',
            p.birthday || '',
            p.marital_status || '',
            p.sex || '',
            p.blood_group || '',
            p.weight || '',
            p.height || '',
            p.address || '',
            p.history || '',
            `<a href="patient-details.html?id=${p.id}" class="mr-4 vue"><span class="fa fa-eye tbl-eye"></span></a>
             <a href="#" class="mr-4 edit-patient" data-bs-toggle="modal" data-bs-target="#modal-edit" data-id="${p.id}"><span class="fas fa-pencil-alt tbl-edit"></span></a>
             <a class="mr-4 delet"><span class="fas fa-trash-alt tbl-delet"></span></a>`
          ]);
        });
        table.draw();
      });
    </script>

    <script>
        // When you click “edit” in the table:
        document.querySelector('#example2 tbody').addEventListener('click', async (e) => {
            const btn = e.target.closest('a.edit-patient');
            if (!btn) return;
            const id = btn.dataset.id;
            const { data: patient, error } = await supabaseClient
                .from('patients')
                .select('*')
                .eq('id', id)
                .single();
            if (error) { console.error(error); return; }
            const form = document.getElementById('edit-patient-form');
            form.dataset.id = id;
            form.querySelector('#edit-firstName').value     = patient.first_name;
            form.querySelector('#edit-lastName').value      = patient.last_name;
            form.querySelector('#edit-email').value         = patient.email;
            form.querySelector('#edit-mobile').value        = patient.phone;
            form.querySelector('#edit-birthday').value      = patient.birthday;
            form.querySelector('#edit-maritalStatus').value = patient.marital_status;
            form.querySelector('#edit-sex').value           = patient.sex;
            form.querySelector('#edit-bloodGroup').value    = patient.blood_group;
            form.querySelector('#edit-weight').value        = patient.weight;
            form.querySelector('#edit-height').value        = patient.height;
            form.querySelector('#edit-address').value       = patient.address;
            form.querySelector('#edit-history').value       = patient.history;
        });

        // When you submit the edit form:
        document.getElementById('edit-patient-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const id = form.dataset.id;
            const updates = {
                first_name:     form.querySelector('#edit-firstName').value,
                last_name:      form.querySelector('#edit-lastName').value,
                email:          form.querySelector('#edit-email').value,
                phone:          form.querySelector('#edit-mobile').value,
                birthday:       form.querySelector('#edit-birthday').value,
                marital_status: form.querySelector('#edit-maritalStatus').value,
                sex:            form.querySelector('#edit-sex').value,
                blood_group:    form.querySelector('#edit-bloodGroup').value,
                weight:         form.querySelector('#edit-weight').value,
                height:         form.querySelector('#edit-height').value,
                address:        form.querySelector('#edit-address').value,
                history:        form.querySelector('#edit-history').value
            };
            const { error } = await supabaseClient
                .from('patients')
                .update(updates)
                .eq('id', id);
            if (error) {
                alert('Update failed: ' + error.message);
            } else {
                $('#modal-edit').modal('hide');
                $('#example2').DataTable().ajax.reload();
            }
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const { data: { user } } = await supabaseClient.auth.getUser();
            if (user && user.email) {
                document.getElementById('user-email').textContent = user.email;
            }
        });
        // Enhanced logout handler (attach to logout link if present)
        document.addEventListener('DOMContentLoaded', () => {
            const logoutLink = document.getElementById('logout-link');
            if (logoutLink) {
                logoutLink.addEventListener('click', async (e) => {
                    e.preventDefault();
                    await supabaseClient.auth.signOut();
                    // Clear stored session data
                    localStorage.clear();
                    sessionStorage.clear();
                    // Replace history entry and redirect to login
                    window.location.replace('page-login.html');
                });
            }
        });
    </script>

</body>

</html>